<mat-horizontal-stepper
  [linear]="true"
  #stepper
  style="position: relative;"
  (selectionChange)="onTabChanged($event)"
>
  <ng-template matStepperIcon="edit">
    <mat-icon>check</mat-icon>
  </ng-template>
  <mat-step [stepControl]="firstFormGroup">
    <form [formGroup]="firstFormGroup">
      <ng-template matStepLabel>Persönliche Daten</ng-template>
      <mat-form-field>
        <mat-label>Name</mat-label>
        <input
          matInput
          placeholder="Last name, First name"
          formControlName="firstCtrl"
          required
        />
      </mat-form-field>
      <div>
        <button mat-button matStepperNext>Weiter</button>
      </div>
    </form>
  </mat-step>
  <mat-step
    #secondStep
    [stepControl]="secondFormGroup"
    [hasError]="secondFormGroup.invalid"
  >
    <form [formGroup]="secondFormGroup">
      <ng-template matStepLabel>Initialer Fragebogen</ng-template>
      <mat-form-field class="full-width mb-3">
        <mat-label>Tag, an dem die ersten Symptome auftraten</mat-label>
        <input
          matInput
          [max]="today"
          [matDatepicker]="picker"
          formControlName="dayOfFirstSymptoms"
        />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        <mat-hint align="start"
          ><strong
            >Falls bislang noch keine Symptome aufgetreten sind, bitte leer
            lassen</strong
          >
        </mat-hint>
      </mat-form-field>

      <mat-label id="min15MinutesContactWithC19PatLabel"
        >Hatten Sie bereits Kontakt mit einer Person, bei der COVID-19
        nachgewiesen wurde?</mat-label
      >
      <mat-radio-group
        required
        aria-labelledby="min15MinutesContactWithC19PatLabel"
        class="example-radio-group"
        formControlName="min15MinutesContactWithC19Pat"
      >
        <mat-radio-button class="example-radio-button" [value]="true">
          Ja
        </mat-radio-button>
        <mat-radio-button class="example-radio-button" [value]="false">
          Nein
        </mat-radio-button>
      </mat-radio-group>
      <mat-label id="nursingActionOnC19PatLabel"
        >Haben Sie eine Person gepflegt / versorgt, bei der COVID-19
        festgestellt wurde?</mat-label
      >
      <mat-radio-group
        required
        aria-labelledby="nursingActionOnC19PatLabel"
        class="example-radio-group"
        formControlName="nursingActionOnC19Pat"
      >
        <mat-radio-button class="example-radio-button" [value]="1">
          Ja
        </mat-radio-button>
        <mat-radio-button class="example-radio-button" [value]="0">
          Nein
        </mat-radio-button>
      </mat-radio-group>
      <mat-label id="directContactWithLiquidsOfC19PatLabel"
        >Hatten Sie direkten Kontakt zu Körperflüssigkeiten von einer Person,
        bei der COVID-19 festgestellt wurde?</mat-label
      >
      <mat-radio-group
        required
        aria-labelledby="directContactWithLiquidsOfC19PatLabel"
        class="example-radio-group"
        formControlName="directContactWithLiquidsOfC19Pat"
      >
        <mat-radio-button class="example-radio-button" [value]="true">
          Ja
        </mat-radio-button>
        <mat-radio-button class="example-radio-button" [value]="false">
          Nein
        </mat-radio-button>
      </mat-radio-group>
      <mat-label id="flightPassengerWithCloseRowC19PatLabel"
        >Saßen Sie auf einem FLug nahe an einer Person, bei der COVID-19
        festgestellt wurde?</mat-label
      >
      <mat-radio-group
        required
        aria-labelledby="flightPassengerWithCloseRowC19PatLabel"
        class="example-radio-group"
        formControlName="flightPassengerWithCloseRowC19Pat"
      >
        <mat-radio-button class="example-radio-button" [value]="true">
          Ja
        </mat-radio-button>
        <mat-radio-button class="example-radio-button" [value]="false">
          Nein
        </mat-radio-button>
      </mat-radio-group>
      <mat-label id="flightAsCrewMemberWithC19PatLabel"
        >Waren Sie Crewmitglied auf einem FLug mit einer Person an Board, bei
        der COVID-19 festgestellt wurde?</mat-label
      >
      <mat-radio-group
        required
        aria-labelledby="flightAsCrewMemberWithC19PatLabel"
        class="example-radio-group"
        formControlName="flightAsCrewMemberWithC19Pat"
      >
        <mat-radio-button class="example-radio-button" [value]="true">
          Ja
        </mat-radio-button>
        <mat-radio-button class="example-radio-button" [value]="false">
          Nein
        </mat-radio-button>
      </mat-radio-group>
      <mat-label id="belongToMedicalStaffLabel"
        >Sind Sie in einem medizinischen Beruf tätig?</mat-label
      >
      <mat-radio-group
        required
        aria-labelledby="belongToMedicalStaffLabel"
        class="example-radio-group"
        formControlName="belongToMedicalStaff"
      >
        <mat-radio-button class="example-radio-button" [value]="true">
          Ja
        </mat-radio-button>
        <mat-radio-button class="example-radio-button" [value]="false">
          Nein
        </mat-radio-button>
      </mat-radio-group>
      <mat-label id="belongToNursingStaffLabel"
        >Sind Sie in einem Pflegeberuf tätig?</mat-label
      >
      <mat-radio-group
        required
        aria-labelledby="belongToNursingStaffLabel"
        class="example-radio-group"
        formControlName="belongToNursingStaff"
      >
        <mat-radio-button class="example-radio-button" [value]="true">
          Ja
        </mat-radio-button>
        <mat-radio-button class="example-radio-button" [value]="false">
          Nein
        </mat-radio-button>
      </mat-radio-group>
      <mat-label id="belongToLaboratoryStaffLabel"
        >Sind Sie in einem Labor tätig?</mat-label
      >
      <mat-radio-group
        required
        aria-labelledby="belongToLaboratoryStaffLabel"
        class="example-radio-group"
        formControlName="belongToLaboratoryStaff"
      >
        <mat-radio-button class="example-radio-button" [value]="true">
          Ja
        </mat-radio-button>
        <mat-radio-button class="example-radio-button" [value]="false">
          Nein
        </mat-radio-button>
      </mat-radio-group>
      <mat-label id="familyMemberLabel"
        >Wurde bei einem Ihrer Familienmitglieder COVID-19
        festgestellt?</mat-label
      >
      <mat-radio-group
        required
        aria-labelledby="familyMemberLabel"
        class="example-radio-group"
        formControlName="familyMember"
      >
        <mat-radio-button class="example-radio-button" [value]="true">
          Ja
        </mat-radio-button>
        <mat-radio-button class="example-radio-button" [value]="false">
          Nein
        </mat-radio-button>
      </mat-radio-group>
      <mat-form-field class="full-width">
        <mat-label
          >Hatten Sie auf andere Art Kontakt mit einer Person, bei der COVID-19
          festgestellt wurde?</mat-label
        >
        <textarea
          [mat-autosize]="true"
          [matAutosizeMinRows]="2"
          matInput
          formControlName="otherContactType"
          placeholder="Falls ja, bitte beschreiben"
        ></textarea>
        <mat-hint align="start"
          ><strong>Falls ja, bitte beschreiben</strong>
        </mat-hint>
      </mat-form-field>
      <div class="mt-3">
        <button mat-button matStepperPrevious>Zurück</button>
        <button mat-button matStepperNext [disabled]="secondStep.hasError">
          Weiter
        </button>
      </div>
    </form>
  </mat-step>
  <mat-step
    #thirdStep
    [stepControl]="thirdFormGroup"
    [hasError]="
      !(hasRetrospectiveContacts() || hasNoRetrospectiveContactsConfirmed())
    "
  >
    <ng-template matStepLabel>Kontaktpersonen</ng-template>
    <div class="info-text">
      <h2>Umgang mit Kontaktpersonen bestätigter COVID-19-Fälle</h2>
      <p>
        Kontaktpersonen sind Personen mit einem unten definierten Kontakt zu
        einem bestätigten Fall von COVID-19 ab dem 2. Tag vor Auftreten der
        ersten Symptome des Falles. Das Ende der infektiösen Periode ist
        momentan nicht sicher anzugeben.
      </p>
    </div>
    <div class="info-text">
      <h2>
        Kontaktpersonen der Kategorie I mit engem Kontakt ("höheres"
        Infektionsrisiko)
      </h2>
      <ul>
        <li>
          Personen mit kumulativ mindestens 15-minütigem Gesichts-
          ("face-to-face") Kontakt, z.B. im Rahmen eines Gesprächs. Dazu gehören
          z.B. Personen aus Lebensgemeinschaften im selben Haushalt.
        </li>
        <li>
          Personen mit direktem Kontakt zu Sekreten oder Körperflüssigkeiten,
          insbesondere zu respiratorischen Sekreten eines bestätigten
          COVID-19-Falls, wie z.B. Küssen, Kontakt zu Erbrochenem, Mund-zu-Mund
          Beatmung, Anhusten, Anniesen, etc.
        </li>
        <li>Personen, die aerosolbildenden Maßnahmen ausgesetzt sind</li>
        <li>
          Medizinisches Personal mit Kontakt zum bestätigten COVID-19-Fall im
          Rahmen von Pflege oder medizinischer Untersuchung (≤ 2m), ohne
          verwendete Schutzausrüstung.
        </li>
      </ul>
    </div>
    <form [formGroup]="thirdFormGroup">
      <fieldset
        *ngFor="let date of datesForRetrospectiveContacts"
        [class]="hasNoRetrospectiveContactsConfirmed() ? 'hidden' : ''"
      >
        <legend>Kontaktpersonen vom {{ date | date: "d.M.y" }}</legend>

        <app-multiple-autocomplete
          [control]="this.thirdFormGroup.controls[date.toLocaleDateString()]"
          [selectableItems]="contactPersons"
          [placeholder]="
            'Kontakte mit anderen Menschen am ' + date.toLocaleDateString()
          "
          [nameProperties]="['firstname', 'surename']"
          (added)="onContactAdded(date, $event)"
          (removed)="onContactRemoved(date, $event)"
        >
        </app-multiple-autocomplete>
        <div
          style="
            display: flex;
            flex-direction: row;
            justify-content: flex-end;
            align-items: center;
          "
        >
          <span class="text-muted">Kontaktperson fehlt in der Liste ?</span>
          <button
            mat-button
            color="primary"
            type="button"
            (click)="openContactDialog()"
            class="p-2 mr-0"
            style="line-height: normal;"
          >
            Hier anlegen
          </button>
        </div>
      </fieldset>
      <mat-checkbox
        [class]="hasRetrospectiveContacts() ? 'hidden' : ''"
        name="noRetrospectiveContactsConfirmed"
        formControlName="noRetrospectiveContactsConfirmed"
        >Ich bestätige, im genannten Zeitraum keinen relevanten Kontakt zu
        anderen Personen gehabt zu haben.</mat-checkbox
      >
      <div class="mt-3">
        <button mat-button matStepperPrevious>Zurück</button>
        <button
          mat-raised-button
          color="primary"
          [routerLink]="['/diary']"
          [disabled]="thirdStep.hasError"
        >
          Erfassung abschließen und zum Tagebuch
        </button>
      </div>
    </form>
  </mat-step>
</mat-horizontal-stepper>
