<mat-horizontal-stepper [linear]="false" #stepper style="position: relative;">
  <mat-step [stepControl]="firstFormGroup">
    <form [formGroup]="firstFormGroup">
      <ng-template matStepLabel>Persönliche Daten</ng-template>
      <mat-form-field>
        <mat-label>Name</mat-label>
        <input
          matInput
          placeholder="Last name, First name"
          formControlName="firstCtrl"
          required
        />
      </mat-form-field>
      <div>
        <button mat-button matStepperNext>Weiter</button>
      </div>
    </form>
  </mat-step>
  <mat-step [stepControl]="secondFormGroup">
    <form [formGroup]="secondFormGroup">
      <ng-template matStepLabel>Initialer Fragebogen</ng-template>
      <mat-form-field>
        <mat-label>Address</mat-label>
        <input
          matInput
          formControlName="secondCtrl"
          placeholder="Ex. 1 Main St, New York, NY"
          required
        />
      </mat-form-field>
      <div>
        <button mat-button matStepperPrevious>Zurück</button>
        <button mat-button matStepperNext>Weiter</button>
      </div>
    </form>
  </mat-step>
  <mat-step
    #thirdStep
    [stepControl]="thirdFormGroup"
    [hasError]="
      !(hasRetrospectiveContacts() || hasNoRetrospectiveContactsConfirmed())
    "
  >
    <ng-template matStepLabel>Kontaktpersonen</ng-template>
    <div class="info-text">
      <h2>Umgang mit Kontaktpersonen bestätigter COVID-19-Fälle</h2>
      <p>
        Kontaktpersonen sind Personen mit einem unten definierten Kontakt zu
        einem bestätigten Fall von COVID-19 ab dem 2. Tag vor Auftreten der
        ersten Symptome des Falles. Das Ende der infektiösen Periode ist
        momentan nicht sicher anzugeben.
      </p>
    </div>
    <div class="info-text">
      <h2>
        Kontaktpersonen der Kategorie I mit engem Kontakt ("höheres"
        Infektionsrisiko)
      </h2>
      <ul>
        <li>
          Personen mit kumulativ mindestens 15-minütigem Gesichts-
          ("face-to-face") Kontakt, z.B. im Rahmen eines Gesprächs. Dazu gehören
          z.B. Personen aus Lebensgemeinschaften im selben Haushalt.
        </li>
        <li>
          Personen mit direktem Kontakt zu Sekreten oder Körperflüssigkeiten,
          insbesondere zu respiratorischen Sekreten eines bestätigten
          COVID-19-Falls, wie z.B. Küssen, Kontakt zu Erbrochenem, Mund-zu-Mund
          Beatmung, Anhusten, Anniesen, etc.
        </li>
        <li>Personen, die aerosolbildenden Maßnahmen ausgesetzt sind</li>
        <li>
          Medizinisches Personal mit Kontakt zum bestätigten COVID-19-Fall im
          Rahmen von Pflege oder medizinischer Untersuchung (≤ 2m), ohne
          verwendete Schutzausrüstung.
        </li>
      </ul>
    </div>
    <form [formGroup]="thirdFormGroup">
      <fieldset
        *ngFor="let date of datesForRetrospectiveContacts"
        [class]="hasNoRetrospectiveContactsConfirmed() ? 'hidden' : ''"
      >
        <legend>Kontaktpersonen vom {{ date | date: "d.M.y" }}</legend>

        <app-multiple-autocomplete
          [control]="this.thirdFormGroup.controls[date.toLocaleDateString()]"
          [selectableItems]="contactPersons"
          [placeholder]="
            'Kontakte mit anderen Menschen am ' + date.toLocaleDateString()
          "
          [nameProperties]="['firstname', 'surename']"
          (added)="onContactAdded(date, $event)"
          (removed)="onContactRemoved(date, $event)"
        >
        </app-multiple-autocomplete>
        <div
          style="
            display: flex;
            flex-direction: row;
            justify-content: flex-end;
            align-items: center;
          "
        >
          <span class="text-muted">Kontaktperson fehlt in der Liste ?</span>
          <button
            mat-button
            color="primary"
            type="button"
            (click)="openContactDialog()"
            class="p-2 mr-0"
            style="line-height: normal;"
          >
            Hier anlegen
          </button>
        </div>
      </fieldset>
      <mat-checkbox
        [class]="hasRetrospectiveContacts() ? 'hidden' : ''"
        name="noRetrospectiveContactsConfirmed"
        formControlName="noRetrospectiveContactsConfirmed"
        >Ich bestätige, im genannten Zeitraum keinen relevanten Kontakt zu
        anderen Personen gehabt zu haben.</mat-checkbox
      >
      <div>
        <button mat-button matStepperPrevious>Zurück</button>
        <button mat-button matStepperNext [disabled]="thirdStep.hasError">
          Erfassung abschließen
        </button>
      </div>
    </form>
  </mat-step>
  <mat-step>
    <ng-template matStepLabel>Fertig</ng-template>
    <p>
      Sie haben es geschafft. Vielen Dank für Ihre Unterstützung bei der
      Aufklärung von Infektionsketten.
    </p>
    <div>
      <button mat-raised-button color="primary" [routerLink]="['/diary']">
        Zum Tagebuch
      </button>
      <button mat-button matStepperPrevious>Zurück</button>
    </div>
  </mat-step>
</mat-horizontal-stepper>
